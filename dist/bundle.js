(()=>{"use strict";var e,t={m:{},u:e=>e+".bundle.js"};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var r=t.g.document;if(!e&&r&&(r.currentScript&&(e=r.currentScript.src),!e)){var a=r.getElementsByTagName("script");if(a.length)for(var s=a.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=a[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),t.b=document.baseURI||self.location.href,function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"}(e||(e={}));const r=(()=>{let e=0;return()=>e++})(),a=(new Error("unknown message type"),new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first")),s=new Error("called FFmpeg.terminate()");new Error("failed to import ffmpeg-core.js");class o{#e=null;#t={};#r={};#a=[];#s=[];loaded=!1;#o=()=>{this.#e&&(this.#e.onmessage=({data:{id:t,type:r,data:a}})=>{switch(r){case e.LOAD:this.loaded=!0,this.#t[t](a);break;case e.MOUNT:case e.UNMOUNT:case e.EXEC:case e.WRITE_FILE:case e.READ_FILE:case e.DELETE_FILE:case e.RENAME:case e.CREATE_DIR:case e.LIST_DIR:case e.DELETE_DIR:this.#t[t](a);break;case e.LOG:this.#a.forEach((e=>e(a)));break;case e.PROGRESS:this.#s.forEach((e=>e(a)));break;case e.ERROR:this.#r[t](a)}delete this.#t[t],delete this.#r[t]})};#i=({type:e,data:t},s=[],o)=>this.#e?new Promise(((a,i)=>{const n=r();this.#e&&this.#e.postMessage({id:n,type:e,data:t},s),this.#t[n]=a,this.#r[n]=i,o?.addEventListener("abort",(()=>{i(new DOMException(`Message # ${n} was aborted`,"AbortError"))}),{once:!0})})):Promise.reject(a);on(e,t){"log"===e?this.#a.push(t):"progress"===e&&this.#s.push(t)}off(e,t){"log"===e?this.#a=this.#a.filter((e=>e!==t)):"progress"===e&&(this.#s=this.#s.filter((e=>e!==t)))}load=({classWorkerURL:r,...a}={},{signal:s}={})=>(this.#e||(this.#e=r?new Worker(new URL(r,"file:///home/pc1827/projects/music-identifier/music-identifier-edge/node_modules/@ffmpeg/ffmpeg/dist/esm/classes.js"),{type:"module"}):new Worker(new URL(t.p+t.u(138),t.b),{type:void 0}),this.#o()),this.#i({type:e.LOAD,data:a},void 0,s));exec=(t,r=-1,{signal:a}={})=>this.#i({type:e.EXEC,data:{args:t,timeout:r}},void 0,a);terminate=()=>{const e=Object.keys(this.#r);for(const t of e)this.#r[t](s),delete this.#r[t],delete this.#t[t];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(t,r,{signal:a}={})=>{const s=[];return r instanceof Uint8Array&&s.push(r.buffer),this.#i({type:e.WRITE_FILE,data:{path:t,data:r}},s,a)};mount=(t,r,a)=>this.#i({type:e.MOUNT,data:{fsType:t,options:r,mountPoint:a}},[]);unmount=t=>this.#i({type:e.UNMOUNT,data:{mountPoint:t}},[]);readFile=(t,r="binary",{signal:a}={})=>this.#i({type:e.READ_FILE,data:{path:t,encoding:r}},void 0,a);deleteFile=(t,{signal:r}={})=>this.#i({type:e.DELETE_FILE,data:{path:t}},void 0,r);rename=(t,r,{signal:a}={})=>this.#i({type:e.RENAME,data:{oldPath:t,newPath:r}},void 0,a);createDir=(t,{signal:r}={})=>this.#i({type:e.CREATE_DIR,data:{path:t}},void 0,r);listDir=(t,{signal:r}={})=>this.#i({type:e.LIST_DIR,data:{path:t}},void 0,r);deleteDir=(t,{signal:r}={})=>this.#i({type:e.DELETE_DIR,data:{path:t}},void 0,r)}new Error("failed to get response body reader"),new Error("failed to complete download");function i(){chrome.tabCapture.capture({audio:!0},(e=>{if(!e)return void console.error("Unable to capture the tab. Is the tab playing audio?");const t=new AudioContext,r=t.createMediaStreamSource(e);r.connect(t.destination);const a=new MediaRecorder(e);let s=[];a.ondataavailable=async e=>{if(e.data.size>1e4){s.push(e.data);const t=new Blob(s,{type:"mp3"});try{const e=await async function(e){const t=new o;await t.load(),await t.writeFile("input.mp3",await(async e=>{let t;if("string"==typeof e)t=/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(e)?atob(e.split(",")[1]).split("").map((e=>e.charCodeAt(0))):await(await fetch(e)).arrayBuffer();else if(e instanceof URL)t=await(await fetch(e)).arrayBuffer();else{if(!(e instanceof File||e instanceof Blob))return new Uint8Array;t=await(r=e,new Promise(((e,t)=>{const a=new FileReader;a.onload=()=>{const{result:t}=a;t instanceof ArrayBuffer?e(new Uint8Array(t)):e(new Uint8Array)},a.onerror=e=>{t(Error(`File could not be read! Code=${e?.target?.error?.code||-1}`))},a.readAsArrayBuffer(r)})))}var r;return new Uint8Array(t)})(e)),await t.readFile("input.mp3"),await t.exec(["-i","input.mp3","-f","s16le","-acodec","pcm_s16le","-ac","1","-ar","44100","output.raw"]);const r=await t.readFile("output.raw");return await async function(e){const t=new Uint8Array(e).reduce(((e,t)=>e+String.fromCharCode(t)),"");return btoa(t)}(r)}(t),r=async function(e){const t={method:"POST",headers:{"content-type":"text/plain","X-RapidAPI-Key":"API-Key","X-RapidAPI-Host":"API-Host"},body:e};try{const e=await fetch("url",t);if(!e.ok)throw new Error("Network response was not ok");return await e.json()}catch(e){chrome.runtime.sendMessage("error")}}(e),a=await r;0==a.matches.length?chrome.runtime.sendMessage("error"):chrome.runtime.sendMessage({type:"SHAZAM_RESULT",data:{coverArt:a.track.images.coverart,title:a.track.title,subtitle:a.track.subtitle,time:(new Date).toLocaleString(),tagid:a.tagid,apple:a.track.hub.options[0].actions[0].uri,spotify:a.track.hub.providers[0].actions[0].uri,youtubeurl:a.track.sections[1].youtubeurl.actions[0].uri}})}catch(e){chrome.runtime.sendMessage("error")}}else chrome.runtime.sendMessage("noAudio")},a.onerror=e=>{chrome.runtime.sendMessage("error")},a.start(),setTimeout((()=>{a.stop(),r.disconnect(t.destination),e.getTracks().forEach((e=>e.stop()))}),4e3)}))}chrome.runtime.onMessage.addListener(((e,t,r)=>{"recordAudio"===e&&i()}))})();